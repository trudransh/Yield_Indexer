module.exports = class Data1768149851395 {
    name = 'Data1768149851395'

    async up(db) {
        await db.query(`CREATE TABLE "apy_snapshot" ("id" character varying NOT NULL, "timestamp" TIMESTAMP WITH TIME ZONE NOT NULL, "block_number" integer NOT NULL, "apy" numeric NOT NULL, "tvl" numeric, "raw_rate" numeric, "price_per_share" numeric, "pool_id" character varying, CONSTRAINT "PK_e56878cdd07379aa68d27fd5721" PRIMARY KEY ("id"))`)
        await db.query(`CREATE INDEX "IDX_f97b219f0e475040e4b0236511" ON "apy_snapshot" ("pool_id") `)
        await db.query(`CREATE INDEX "IDX_6cc47d44a10ea0d728cea44d9f" ON "apy_snapshot" ("timestamp") `)
        await db.query(`CREATE INDEX "IDX_40e546c42e9a84a8c03dc0e80d" ON "apy_snapshot" ("block_number") `)
        await db.query(`CREATE TABLE "rate_update" ("id" character varying NOT NULL, "timestamp" TIMESTAMP WITH TIME ZONE NOT NULL, "block_number" integer NOT NULL, "tx_hash" text NOT NULL, "log_index" integer NOT NULL, "liquidity_rate" numeric, "variable_borrow_rate" numeric, "stable_borrow_rate" numeric, "utilization_rate" numeric, "supply_apy" numeric NOT NULL, "pool_id" character varying, CONSTRAINT "PK_b67050afd773a9e433a736e2fcd" PRIMARY KEY ("id"))`)
        await db.query(`CREATE INDEX "IDX_c53bda533840b9b33a25531815" ON "rate_update" ("pool_id") `)
        await db.query(`CREATE INDEX "IDX_98ef070c9dd653f42221fead47" ON "rate_update" ("timestamp") `)
        await db.query(`CREATE INDEX "IDX_a11e253dffbfdfae9556409152" ON "rate_update" ("block_number") `)
        await db.query(`CREATE INDEX "IDX_78c726a331d1dd50a14d99ebf5" ON "rate_update" ("tx_hash") `)
        await db.query(`CREATE TABLE "pool" ("id" character varying NOT NULL, "chain_id" integer NOT NULL, "contract_address" text NOT NULL, "name" text NOT NULL, "underlying_token" text NOT NULL, "underlying_symbol" text NOT NULL, "pool_type" text NOT NULL, "current_apy" numeric, "current_tvl" numeric, "last_updated_at" TIMESTAMP WITH TIME ZONE, "last_price_per_share" numeric, "discovered_via" text, "is_active" boolean NOT NULL, "created_at" TIMESTAMP WITH TIME ZONE NOT NULL, "protocol_id" character varying, CONSTRAINT "PK_db1bfe411e1516c01120b85f8fe" PRIMARY KEY ("id"))`)
        await db.query(`CREATE INDEX "IDX_ca7b22bed322c7c1c817d7fefc" ON "pool" ("chain_id") `)
        await db.query(`CREATE INDEX "IDX_8c1f0f534916abc41e00b4cc47" ON "pool" ("protocol_id") `)
        await db.query(`CREATE INDEX "IDX_1e8c2b2707bcf5a062cba18389" ON "pool" ("contract_address") `)
        await db.query(`CREATE INDEX "IDX_192268181e9fa0826f7fbc4649" ON "pool" ("underlying_symbol") `)
        await db.query(`CREATE TABLE "protocol" ("id" character varying NOT NULL, "display_name" text NOT NULL, "risk_score" numeric NOT NULL, "pool_abi_type" text NOT NULL, "created_at" TIMESTAMP WITH TIME ZONE NOT NULL, CONSTRAINT "PK_bae34901abddccbddda15ea000c" PRIMARY KEY ("id"))`)
        await db.query(`CREATE TABLE "vault_event" ("id" character varying NOT NULL, "timestamp" TIMESTAMP WITH TIME ZONE NOT NULL, "block_number" integer NOT NULL, "tx_hash" text NOT NULL, "log_index" integer NOT NULL, "event_type" text NOT NULL, "sender" text NOT NULL, "owner" text NOT NULL, "assets" numeric NOT NULL, "shares" numeric NOT NULL, "price_per_share" numeric, "total_assets" numeric, "pool_id" character varying, CONSTRAINT "PK_a1be97443793296b28b30b2a225" PRIMARY KEY ("id"))`)
        await db.query(`CREATE INDEX "IDX_b0d1c1e0951d841ae93269f6bf" ON "vault_event" ("pool_id") `)
        await db.query(`CREATE INDEX "IDX_96290d8802d8ac228ca044bad5" ON "vault_event" ("timestamp") `)
        await db.query(`CREATE INDEX "IDX_3217ffc63c0b46d2a1e2ec40e5" ON "vault_event" ("block_number") `)
        await db.query(`CREATE INDEX "IDX_af9ec0fe597bbcb225635ffa57" ON "vault_event" ("tx_hash") `)
        await db.query(`CREATE INDEX "IDX_4fefaa1b3331e2a01081053364" ON "vault_event" ("sender") `)
        await db.query(`CREATE INDEX "IDX_34bc013294dc37f9a98a7420d7" ON "vault_event" ("owner") `)
        await db.query(`CREATE TABLE "pool_metrics" ("id" character varying NOT NULL, "avg_apy1h" numeric, "avg_apy24h" numeric, "avg_apy7d" numeric, "avg_apy30d" numeric, "stability_score" numeric, "cv1h" numeric, "cv6h" numeric, "cv24h" numeric, "cv_weighted" numeric, "updated_at" TIMESTAMP WITH TIME ZONE NOT NULL, "pool_id" character varying, CONSTRAINT "REL_fb624a3965eaa9a97555776b62" UNIQUE ("pool_id"), CONSTRAINT "PK_5b96a60e9d76f812274caf23caa" PRIMARY KEY ("id"))`)
        await db.query(`CREATE UNIQUE INDEX "IDX_fb624a3965eaa9a97555776b62" ON "pool_metrics" ("pool_id") `)
        await db.query(`ALTER TABLE "apy_snapshot" ADD CONSTRAINT "FK_f97b219f0e475040e4b02365113" FOREIGN KEY ("pool_id") REFERENCES "pool"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
        await db.query(`ALTER TABLE "rate_update" ADD CONSTRAINT "FK_c53bda533840b9b33a255318153" FOREIGN KEY ("pool_id") REFERENCES "pool"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
        await db.query(`ALTER TABLE "pool" ADD CONSTRAINT "FK_8c1f0f534916abc41e00b4cc474" FOREIGN KEY ("protocol_id") REFERENCES "protocol"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
        await db.query(`ALTER TABLE "vault_event" ADD CONSTRAINT "FK_b0d1c1e0951d841ae93269f6bf4" FOREIGN KEY ("pool_id") REFERENCES "pool"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
        await db.query(`ALTER TABLE "pool_metrics" ADD CONSTRAINT "FK_fb624a3965eaa9a97555776b621" FOREIGN KEY ("pool_id") REFERENCES "pool"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`)
    }

    async down(db) {
        await db.query(`DROP TABLE "apy_snapshot"`)
        await db.query(`DROP INDEX "public"."IDX_f97b219f0e475040e4b0236511"`)
        await db.query(`DROP INDEX "public"."IDX_6cc47d44a10ea0d728cea44d9f"`)
        await db.query(`DROP INDEX "public"."IDX_40e546c42e9a84a8c03dc0e80d"`)
        await db.query(`DROP TABLE "rate_update"`)
        await db.query(`DROP INDEX "public"."IDX_c53bda533840b9b33a25531815"`)
        await db.query(`DROP INDEX "public"."IDX_98ef070c9dd653f42221fead47"`)
        await db.query(`DROP INDEX "public"."IDX_a11e253dffbfdfae9556409152"`)
        await db.query(`DROP INDEX "public"."IDX_78c726a331d1dd50a14d99ebf5"`)
        await db.query(`DROP TABLE "pool"`)
        await db.query(`DROP INDEX "public"."IDX_ca7b22bed322c7c1c817d7fefc"`)
        await db.query(`DROP INDEX "public"."IDX_8c1f0f534916abc41e00b4cc47"`)
        await db.query(`DROP INDEX "public"."IDX_1e8c2b2707bcf5a062cba18389"`)
        await db.query(`DROP INDEX "public"."IDX_192268181e9fa0826f7fbc4649"`)
        await db.query(`DROP TABLE "protocol"`)
        await db.query(`DROP TABLE "vault_event"`)
        await db.query(`DROP INDEX "public"."IDX_b0d1c1e0951d841ae93269f6bf"`)
        await db.query(`DROP INDEX "public"."IDX_96290d8802d8ac228ca044bad5"`)
        await db.query(`DROP INDEX "public"."IDX_3217ffc63c0b46d2a1e2ec40e5"`)
        await db.query(`DROP INDEX "public"."IDX_af9ec0fe597bbcb225635ffa57"`)
        await db.query(`DROP INDEX "public"."IDX_4fefaa1b3331e2a01081053364"`)
        await db.query(`DROP INDEX "public"."IDX_34bc013294dc37f9a98a7420d7"`)
        await db.query(`DROP TABLE "pool_metrics"`)
        await db.query(`DROP INDEX "public"."IDX_fb624a3965eaa9a97555776b62"`)
        await db.query(`ALTER TABLE "apy_snapshot" DROP CONSTRAINT "FK_f97b219f0e475040e4b02365113"`)
        await db.query(`ALTER TABLE "rate_update" DROP CONSTRAINT "FK_c53bda533840b9b33a255318153"`)
        await db.query(`ALTER TABLE "pool" DROP CONSTRAINT "FK_8c1f0f534916abc41e00b4cc474"`)
        await db.query(`ALTER TABLE "vault_event" DROP CONSTRAINT "FK_b0d1c1e0951d841ae93269f6bf4"`)
        await db.query(`ALTER TABLE "pool_metrics" DROP CONSTRAINT "FK_fb624a3965eaa9a97555776b621"`)
    }
}
